{% extends "base.html" %}
{% block content %}
<div class="row g-3">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="label mb-0">Bestiario</div>
          <div class="small text-muted">{{ total }} risultati</div>
        </div>

        {% if not table_found %}
          <div class="alert alert-warning mb-0">
            Tabella bestiario non trovata (attese: <code>monsters</code>, <code>bestiary</code>, <code>creatures</code>).
          </div>
        {% else %}
          <form method="get" action="{{ url_for('bestiary') }}" class="row g-2 align-items-end mb-3">
            <div class="col-12 col-md-6">
              <label class="text-muted mb-1">Nome</label>
              <input class="form-control form-control-sm" type="text" name="q" value="{{ q }}" placeholder="Cerca mostro...">
            </div>
            <div class="col-12 col-md-3">
              <label class="text-muted mb-1">Grado di Sfida (GS)</label>
              <select class="form-select form-select-sm" name="cr" {% if not cr_col %}disabled{% endif %}>
                <option value="">Tutti</option>
                {% for opt in cr_options %}
                  <option value="{{ opt }}" {% if cr == opt %}selected{% endif %}>{{ opt }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-12 col-md-3">
              <div class="d-grid">
                <button class="btn btn-sm btn-primary" type="submit">Filtra</button>
              </div>
            </div>
          </form>

          {% if monsters %}
            <div class="table-responsive">
              <table class="table table-sm align-middle mb-0">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th style="width: 120px;">Grado di Sfida (GS)</th>
                    <th>Tipo</th>
                  </tr>
                </thead>
                <tbody>
                  {% for m in monsters %}
                    <tr>
                      <td>
                        <a href="{{ url_for('bestiary_detail', monster_id=m.id) }}">{{ m.get(name_col) }}</a>
                      </td>
                      <td class="mono">{{ m.get(cr_col) if cr_col else "-" }}</td>
                      <td>{{ m.get(type_col) if type_col else "-" }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-muted small">Nessun mostro trovato.</div>
          {% endif %}

          <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="small text-muted">Pagina {{ page }}</div>
            <div class="d-flex gap-2">
              {% if has_prev %}
                <a
                  class="btn btn-sm btn-outline-secondary"
                  href="{{ url_for('bestiary', q=q, cr=cr, page=page-1) }}"
                >Precedente</a>
              {% endif %}
              {% if has_next %}
                <a
                  class="btn btn-sm btn-outline-secondary"
                  href="{{ url_for('bestiary', q=q, cr=cr, page=page+1) }}"
                >Successiva</a>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
